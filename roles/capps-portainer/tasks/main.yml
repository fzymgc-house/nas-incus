#SPDX-License-Identifier: MIT-0
---
# tasks file for capps-portainer

- name: Create portainer data directory
  ansible.builtin.file:
    path: "{{ host_data_base_dir }}/portainer"
    owner: "{{ host_data_dir_owner }}"
    group: "{{ host_data_dir_group }}"
    mode: "{{ host_data_dir_mode }}"
    state: directory

- name: Run portainer as a docker container
  community.docker.docker_container:
    name: portainer
    image: portainer/portainer-ce:lts@sha256:224a378fbc5ae579dc9d570c5ca2e5e981a4a003c8d7c2c5b5e482af97c2f87c
    volumes:
      - "{{ host_data_base_dir }}/portainer:/data"
      - "/var/run/docker.sock:/var/run/docker.sock"
    ports:
      - "{{ ansible_eth1.ipv4.address }}:9443:9443"
      - "{{ ansible_eth1.ipv4.address }}:8000:8000"
    env:
      - "TZ=America/New_York"
      - "TRUSTED_ORIGINS=https://nas-portainer.fzymgc.house"
